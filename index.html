<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/17/hello-world/" class="article-date">
  <time datetime="2017-08-17T11:38:46.000Z" itemprop="datePublished">2017-08-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/17/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/17/hello-world/" data-id="cj6gh2nx90008ljdw7pn01lzq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-解读vue双向绑定的内部实现原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/14/解读vue双向绑定的内部实现原理/" class="article-date">
  <time datetime="2017-08-13T23:43:45.000Z" itemprop="datePublished">2017-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="解读vue双向绑定的内部实现原理"><a href="#解读vue双向绑定的内部实现原理" class="headerlink" title="解读vue双向绑定的内部实现原理"></a>解读vue双向绑定的内部实现原理</h1><p>为了更加直观让读者看清vue的双向绑定，下面围绕一个项目demo（<a href="">vue-mvvm</a>）来展开解读：</p>
<p><strong>vue-mvvm/index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>VUE-MVVM<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"vue-mvvm"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"name"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./observer.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./watcher.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./compile.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./mvvm.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">	<span class="keyword">var</span> mvvm = <span class="keyword">new</span> MVVM(&#123;</span></div><div class="line"><span class="javascript">		el: <span class="string">'#vue-mvvm'</span>,</span></div><div class="line"><span class="undefined">		data: &#123;</span></div><div class="line"><span class="javascript">			name: <span class="string">'vue-mvvm'</span>,</span></div><div class="line"><span class="undefined">		&#125;,</span></div><div class="line"><span class="undefined">	&#125;);</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>这部分代码其实没什么好讲的，完全类似于VUE的初始化方法，参数el用于设置绑定的起始节点，data用于设置双向绑定view-model的初始化数据。</p>
<p><strong>vue-mvvm/mvvm.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">$window</span>) </span>&#123;</div><div class="line"><span class="meta">    'use strict'</span>;</div><div class="line">    $<span class="built_in">window</span>.MVVM =  <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.$options = options || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> data = <span class="keyword">this</span>._data = <span class="keyword">this</span>.$options.data;</div><div class="line">        <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data !== <span class="string">'object'</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">        <span class="comment">// 数据代理</span></div><div class="line">        <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</div><div class="line">            me._proxyData(key);</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        $<span class="built_in">window</span>.createObserve(data, <span class="keyword">this</span>);</div><div class="line"></div><div class="line">        <span class="keyword">this</span>.$compile = <span class="keyword">new</span> $<span class="built_in">window</span>.Compile(options.el || <span class="built_in">document</span>.body, <span class="keyword">this</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $<span class="built_in">window</span>.MVVM.prototype = &#123;</div><div class="line">        $watch: <span class="function"><span class="keyword">function</span> (<span class="params">key, cb, options</span>) </span>&#123;</div><div class="line">            <span class="keyword">new</span> Watcher(<span class="keyword">this</span>, key, cb);</div><div class="line">        &#125;,</div><div class="line">        _proxyData: <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">            <span class="built_in">Object</span>.defineProperty(me, key, &#123;    <span class="comment">// 设置在this上的是data值映射的是this._data上的值</span></div><div class="line">                configurable: <span class="literal">false</span>,</div><div class="line">                enumerable: <span class="literal">true</span>,</div><div class="line">                get: <span class="function"><span class="keyword">function</span> <span class="title">proxyGetter</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">return</span> me._data[key];</div><div class="line">                &#125;,</div><div class="line">                set: <span class="function"><span class="keyword">function</span> <span class="title">proxySetter</span>(<span class="params">newVal</span>) </span>&#123;</div><div class="line">                    me._data[key] = newVal;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">    &#125;;</div><div class="line">&#125;(<span class="built_in">window</span>));</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong></p>
<p><strong>vue-mvvm/compile.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 用于编译解析dom节点并关联view-model</span></div><div class="line"><span class="comment"> */</span></div><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">$window</span>) </span>&#123;</div><div class="line"><span class="meta">    'use strict'</span>;</div><div class="line">    $<span class="built_in">window</span>.Compile = <span class="function"><span class="keyword">function</span> (<span class="params">el, vm</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.$vm = vm;</div><div class="line">        <span class="keyword">this</span>.$el = <span class="keyword">this</span>.isElementNode(el) ? el : <span class="built_in">document</span>.querySelector(el);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.$el) &#123;</div><div class="line">            <span class="keyword">this</span>.$fragment = <span class="keyword">this</span>.node2Fragment(<span class="keyword">this</span>.$el);</div><div class="line">            <span class="keyword">this</span>.compileWarp(<span class="keyword">this</span>.$fragment);</div><div class="line">            <span class="keyword">this</span>.$el.appendChild(<span class="keyword">this</span>.$fragment);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    $<span class="built_in">window</span>.Compile.prototype = &#123;</div><div class="line">        <span class="comment">/*将dom节点转成fragment*/</span></div><div class="line">        node2Fragment: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> fragment = <span class="built_in">document</span>.createDocumentFragment(), child;</div><div class="line">            <span class="comment">// 将原生节点拷贝到fragment</span></div><div class="line">            <span class="keyword">while</span> (child = el.firstChild) &#123;</div><div class="line">                fragment.appendChild(child);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> fragment;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*编译节点*/</span></div><div class="line">        compileWarp: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> childNodes = el.childNodes, me = <span class="keyword">this</span>;</div><div class="line">            <span class="built_in">Array</span>.prototype.slice.call(childNodes).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> text = node.textContent;</div><div class="line">                <span class="keyword">var</span> reg = <span class="regexp">/\&#123;\&#123;(.*)\&#125;\&#125;/</span>;</div><div class="line">                <span class="keyword">if</span> (me.isElementNode(node)) &#123;</div><div class="line">                    me.compileElement(node);</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (me.isTextNode(node) &amp;&amp; reg.test(text)) &#123;</div><div class="line">                    me.compileText(node, <span class="built_in">RegExp</span>.$<span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (node.childNodes &amp;&amp; node.childNodes.length) &#123;</div><div class="line">                    me.compileWarp(node);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*编译dom节点*/</span></div><div class="line">        compileElement: <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> nodeAttrs = node.attributes,</div><div class="line">                me = <span class="keyword">this</span>;</div><div class="line">            <span class="built_in">Array</span>.prototype.slice.call(nodeAttrs).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">attr</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> attrName = attr.name;</div><div class="line">                <span class="keyword">if</span> (me.isDirective(attrName)) &#123;</div><div class="line">                    <span class="keyword">var</span> exp = attr.value;</div><div class="line">                    <span class="keyword">var</span> dir = attrName.substring(<span class="number">2</span>);</div><div class="line">                    compileUtil[dir] &amp;&amp; compileUtil[dir](node, me.$vm, exp);</div><div class="line">                    node.removeAttribute(attrName);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*编译文本节点*/</span></div><div class="line">        compileText: <span class="function"><span class="keyword">function</span> (<span class="params">node, exp</span>) </span>&#123;</div><div class="line">            compileUtil.text(node, <span class="keyword">this</span>.$vm, exp);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*判断是否为指令*/</span></div><div class="line">        isDirective: <span class="function"><span class="keyword">function</span> (<span class="params">attr</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> attr.indexOf(<span class="string">'v-'</span>) == <span class="number">0</span>;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*判断是否为dom节点*/</span></div><div class="line">        isElementNode: <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> node.nodeType == <span class="number">1</span>;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*判断是否为文本节点*/</span></div><div class="line">        isTextNode: <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> node.nodeType == <span class="number">3</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 指令处理集合</span></div><div class="line">    <span class="keyword">var</span> compileUtil = &#123;</div><div class="line">        <span class="comment">/*处理文本单向绑定*/</span></div><div class="line">        text: <span class="function"><span class="keyword">function</span> (<span class="params">node, vm, exp</span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.bind(node, vm, exp, <span class="string">'text'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*处理指令双向绑定*/</span></div><div class="line">        model: <span class="function"><span class="keyword">function</span> (<span class="params">node, vm, exp</span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.bind(node, vm, exp, <span class="string">'model'</span>);</div><div class="line"></div><div class="line">            <span class="keyword">var</span> me = <span class="keyword">this</span>, val = <span class="keyword">this</span>._getVMVal(vm, exp);</div><div class="line">            node.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> newValue = e.target.value;</div><div class="line">                <span class="keyword">if</span> (val === newValue) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                me._setVMVal(vm, exp, newValue);</div><div class="line">                val = newValue;</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*建立数据和视图的绑定关系*/</span></div><div class="line">        bind: <span class="function"><span class="keyword">function</span> (<span class="params">node, vm, exp, dir</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> updaterFn = updater[dir + <span class="string">'Updater'</span>];</div><div class="line"></div><div class="line">            updaterFn &amp;&amp; updaterFn(node, <span class="keyword">this</span>._getVMVal(vm, exp));</div><div class="line"></div><div class="line">            <span class="keyword">new</span> $<span class="built_in">window</span>.Watcher(vm, exp, <span class="function"><span class="keyword">function</span> (<span class="params">value, oldValue</span>) </span>&#123;</div><div class="line">                updaterFn &amp;&amp; updaterFn(node, value, oldValue);</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*根据视图的表达式获取相应的数据*/</span></div><div class="line">        _getVMVal: <span class="function"><span class="keyword">function</span> (<span class="params">vm, exp</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> val = vm;</div><div class="line">            exp = exp.split(<span class="string">'.'</span>);</div><div class="line">            exp.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">k</span>) </span>&#123;</div><div class="line">                val = val[k];</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">return</span> val;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*更新视图表达式的值*/</span></div><div class="line">        _setVMVal: <span class="function"><span class="keyword">function</span> (<span class="params">vm, exp, value</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> val = vm;</div><div class="line">            exp = exp.split(<span class="string">'.'</span>);</div><div class="line">            exp.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">k, i</span>) </span>&#123;</div><div class="line">                <span class="comment">// 非最后一个key，更新val的值</span></div><div class="line">                <span class="keyword">if</span> (i &lt; exp.length - <span class="number">1</span>) &#123;</div><div class="line">                    val = val[k];</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    val[k] = value;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> updater = &#123;</div><div class="line">        <span class="comment">/*设置dom节点的文本值*/</span></div><div class="line">        textUpdater: <span class="function"><span class="keyword">function</span> (<span class="params">node, value</span>) </span>&#123;</div><div class="line">            node.textContent = <span class="keyword">typeof</span> value == <span class="string">'undefined'</span> ? <span class="string">''</span> : value;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*设置dom节点的value值*/</span></div><div class="line">        modelUpdater: <span class="function"><span class="keyword">function</span> (<span class="params">node, value</span>) </span>&#123;</div><div class="line">            node.value = <span class="keyword">typeof</span> value == <span class="string">'undefined'</span> ? <span class="string">''</span> : value;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;(<span class="built_in">window</span>));</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong></p>
<p><strong>vue-mvvm/watcher.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 用于监听数据变化并通知，一旦数据发生变化通知订阅者</span></div><div class="line"><span class="comment"> */</span></div><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">$window</span>) </span>&#123;</div><div class="line"><span class="meta">    'use strict'</span>;</div><div class="line">    $<span class="built_in">window</span>.Watcher =  <span class="function"><span class="keyword">function</span>(<span class="params">vm, expOrFn, cb</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.cb = cb;</div><div class="line">        <span class="keyword">this</span>.vm = vm;</div><div class="line">        <span class="keyword">this</span>.depIds = &#123;&#125;;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> expOrFn === <span class="string">'function'</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.getter = expOrFn;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">this</span>.getter = <span class="keyword">this</span>.parseGetter(expOrFn);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.value = <span class="keyword">this</span>.get();</div><div class="line">    &#125;</div><div class="line">    $<span class="built_in">window</span>.Watcher.prototype = &#123;</div><div class="line">        update: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.run();</div><div class="line">        &#125;,</div><div class="line">        run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> value = <span class="keyword">this</span>.get();</div><div class="line">            <span class="keyword">var</span> oldVal = <span class="keyword">this</span>.value;</div><div class="line">            <span class="keyword">if</span> (value !== oldVal) &#123;</div><div class="line">                <span class="keyword">this</span>.value = value;</div><div class="line">                <span class="keyword">this</span>.cb.call(<span class="keyword">this</span>.vm, value, oldVal);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*添加订阅者*/</span></div><div class="line">        addDep: <span class="function"><span class="keyword">function</span> (<span class="params">dep</span>) </span>&#123;</div><div class="line">            <span class="comment">// 1. 每次调用run()的时候会触发相应属性的getter</span></div><div class="line">            <span class="comment">// getter里面会触发dep.depend()，继而触发这里的addDep</span></div><div class="line">            <span class="comment">// 2. 假如相应属性的dep.id已经在当前watcher的depIds里，说明不是一个新的属性，仅仅是改变了其值而已</span></div><div class="line">            <span class="comment">// 则不需要将当前watcher添加到该属性的dep里</span></div><div class="line">            <span class="comment">// 3. 假如相应属性是新的属性，则将当前watcher添加到新属性的dep里</span></div><div class="line">            <span class="comment">// 如通过 vm.child = &#123;name: 'a'&#125; 改变了 child.name 的值，child.name 就是个新属性</span></div><div class="line">            <span class="comment">// 则需要将当前watcher(child.name)加入到新的 child.name 的dep里</span></div><div class="line">            <span class="comment">// 因为此时 child.name 是个新值，之前的 setter、dep 都已经失效，如果不把 watcher 加入到新的 child.name 的dep中</span></div><div class="line">            <span class="comment">// 通过 child.name = xxx 赋值的时候，对应的 watcher 就收不到通知，等于失效了</span></div><div class="line">            <span class="comment">// 4. 每个子属性的watcher在添加到子属性的dep的同时，也会添加到父属性的dep</span></div><div class="line">            <span class="comment">// 监听子属性的同时监听父属性的变更，这样，父属性改变时，子属性的watcher也能收到通知进行update</span></div><div class="line">            <span class="comment">// 这一步是在 this.get() --&gt; this.getVMVal() 里面完成，forEach时会从父级开始取值，间接调用了它的getter</span></div><div class="line">            <span class="comment">// 触发了addDep(), 在整个forEach过程，当前wacher都会加入到每个父级过程属性的dep</span></div><div class="line">            <span class="comment">// 例如：当前watcher的是'child.child.name', 那么child, child.child, child.child.name这三个属性的dep都会加入当前watcher</span></div><div class="line">            <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">            <span class="keyword">if</span> (!me.depIds.hasOwnProperty(dep.id)) &#123;</div><div class="line">                dep.addSub(me);</div><div class="line">                me.depIds[dep.id] = dep;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            $<span class="built_in">window</span>.Dep.target = <span class="keyword">this</span>;</div><div class="line">            <span class="keyword">var</span> value = <span class="keyword">this</span>.getter.call(<span class="keyword">this</span>.vm);</div><div class="line">            $<span class="built_in">window</span>.Dep.target = <span class="literal">null</span>;</div><div class="line">            <span class="keyword">return</span> value;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*解析表达式并获取相应值的的get方法*/</span></div><div class="line">        parseGetter: <span class="function"><span class="keyword">function</span> (<span class="params">exp</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (<span class="regexp">/[^\w.$]/</span>.test(exp)) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">            <span class="keyword">var</span> exps = exp.split(<span class="string">'.'</span>);</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = exps.length; i &lt; len; i++) &#123;</div><div class="line">                    <span class="keyword">if</span> (!obj) <span class="keyword">return</span>;</div><div class="line">                    obj = obj[exps[i]];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;(<span class="built_in">window</span>));</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong></p>
<p><strong>vue-mvvm/observer.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 用于观察数据变化并通知更新数据</span></div><div class="line"><span class="comment"> */</span></div><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">$window</span>) </span>&#123;</div><div class="line"><span class="meta">    'use strict'</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data = data;</div><div class="line">        <span class="keyword">this</span>.convertWarp(data);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> uid = <span class="number">0</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 定义订阅器，用于添加或删除数据的订阅者以及当数据更改通知到相应的订阅者</span></div><div class="line"><span class="comment">     * @constructor</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    $<span class="built_in">window</span>.Dep =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = uid++;    <span class="comment">// 订阅者ID</span></div><div class="line">        <span class="keyword">this</span>.subs = [];     <span class="comment">// 订阅者集合</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $<span class="built_in">window</span>.Dep.prototype = &#123;</div><div class="line">        <span class="comment">/*添加订阅者*/</span></div><div class="line">        addSub: <span class="function"><span class="keyword">function</span>(<span class="params">sub</span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.subs.push(sub);</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        depend: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            $<span class="built_in">window</span>.Dep.target.addDep(<span class="keyword">this</span>);</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        removeSub: <span class="function"><span class="keyword">function</span>(<span class="params">sub</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> index = <span class="keyword">this</span>.subs.indexOf(sub);</div><div class="line">            <span class="keyword">if</span> (index != <span class="number">-1</span>) &#123;</div><div class="line">                <span class="keyword">this</span>.subs.splice(index, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        notify: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.subs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">sub</span>) </span>&#123;</div><div class="line">                sub.update();</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/*当前监听器对象*/</span></div><div class="line">    $<span class="built_in">window</span>.Dep.target = <span class="literal">null</span>;</div><div class="line"></div><div class="line">    Observer.prototype = &#123;</div><div class="line">        convertWarp: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">            <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</div><div class="line">                me.convert(data,key, data[key]);</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*通过数据劫持实现双向绑定*/</span></div><div class="line">        convert: <span class="function"><span class="keyword">function</span>(<span class="params">data, key, val</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> dep = <span class="keyword">new</span> $<span class="built_in">window</span>.Dep();</div><div class="line">            <span class="keyword">var</span> childObj = $<span class="built_in">window</span>.createObserve(val);</div><div class="line">            <span class="built_in">Object</span>.defineProperty(data, key, &#123;</div><div class="line">                enumerable: <span class="literal">true</span>, <span class="comment">// 可枚举</span></div><div class="line">                configurable: <span class="literal">false</span>, <span class="comment">// 不能再define</span></div><div class="line">                get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">if</span> ($<span class="built_in">window</span>.Dep.target) &#123;</div><div class="line">                        dep.depend();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> val;</div><div class="line">                &#125;,</div><div class="line">                set: <span class="function"><span class="keyword">function</span>(<span class="params">newVal</span>) </span>&#123;</div><div class="line">                    <span class="keyword">if</span> (newVal === val) &#123;</div><div class="line">                        <span class="keyword">return</span>;</div><div class="line">                    &#125;</div><div class="line">                    val = newVal;</div><div class="line">                    <span class="comment">// 新的值是object的话，进行监听</span></div><div class="line">                    childObj = $<span class="built_in">window</span>.createObserve(newVal);</div><div class="line">                    <span class="comment">// 通知订阅者</span></div><div class="line">                    dep.notify();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    $<span class="built_in">window</span>.createObserve = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!value || <span class="keyword">typeof</span> value !== <span class="string">'object'</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Observer(value);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;(<span class="built_in">window</span>));</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/14/解读vue双向绑定的内部实现原理/" data-id="cj6gh2ny5000iljdwf5a5j4a2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ES6迭代器（interator）和for...of...循环" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/13/ES6迭代器（interator）和for...of...循环/" class="article-date">
  <time datetime="2017-08-13T03:38:03.000Z" itemprop="datePublished">2017-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ES6迭代器（interator）和for…of…循环"><a href="#ES6迭代器（interator）和for…of…循环" class="headerlink" title="ES6迭代器（interator）和for…of…循环"></a>ES6迭代器（interator）和for…of…循环</h1><p>或许在写ES6的代码的时候，你可能没有感觉有用过迭代器这个东西，可是ES6中的for…of…循环我们都不陌生，而for…of…循环的必要条件就是必须满足被循环的对象实现了迭代器接口才行。例子如下：</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line"><span class="keyword">var</span> b = &#123;</div><div class="line">    name:<span class="string">'arvin'</span>,</div><div class="line">    age:<span class="number">30</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> a)&#123;</div><div class="line">    <span class="built_in">console</span>.log(i);     <span class="comment">// 结果依次是：1，2，3</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> j <span class="keyword">of</span> b)&#123;</div><div class="line">    <span class="built_in">console</span>.log(j);     <span class="comment">// TypeError: b[Symbol.iterator] is not a function</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>对于上面代码的结果我们基本都知道，可是为什么是这个结果就不会很懂了。从代码的结果可以看出，for…of…循环可行的条件是需要被循环对象实现一个以Symbol.iterator为方法属性才行。而数组对象是默认实现了该方法的，所以并未报错。现在我们就来具体实现一下这个迭代器接口。</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> b = &#123;</div><div class="line">    name:<span class="string">'arvin'</span>,</div><div class="line">    age:<span class="number">30</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">Object</span>.defineProperty(b, <span class="built_in">Symbol</span>.iterator, &#123;</div><div class="line">    enumerable: <span class="literal">false</span>,</div><div class="line">    writable: <span class="literal">false</span>,</div><div class="line">    configurable: <span class="literal">true</span>,</div><div class="line">    value: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">var</span> idx = <span class="number">0</span>;</div><div class="line">        <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(me);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            next: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> &#123;</div><div class="line">                    value: me[keys[idx++]],</div><div class="line">                    done: (idx &gt; keys.length)</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> j <span class="keyword">of</span> b)&#123;</div><div class="line">    <span class="built_in">console</span>.log(j);     <span class="comment">// 结果依次是：arvin,30</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 下面的代码类似上面的for...of...循环的内部实现</span></div><div class="line"><span class="keyword">var</span> c = b[<span class="built_in">Symbol</span>.iterator]();</div><div class="line"><span class="keyword">while</span>(<span class="literal">true</span>)&#123;</div><div class="line">  <span class="keyword">var</span> newValue = c.next();</div><div class="line">  <span class="keyword">if</span>(newValue.done)&#123;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(newValue.value)   <span class="comment">// 结果依次是：arvin,30</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>从上面的这个demo可以看出，ES6的迭代器是<strong>实现要求必须要实现一个Symbol.iterator接口，并且该接口要返回一个带有next方法的对象，而且该next方法必须包含至少两个值，value以及done，前者是迭代器的输出值，后者是判断迭代终止条件。</strong>下面附上一个通用上传迭代器的运用例子：</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> getUploadObj = &#123;</div><div class="line">    getActiveUploadObj ()&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'TXFTNActiveX.FTNUpload'</span>);   <span class="comment">// IE上传控件</span></div><div class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    getFalshUploadObj () &#123;  </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">new</span> ActiveXObject(<span class="string">'ShockwaveFlash.ShockwaveFlash'</span>);   <span class="comment">// Flash上传控件</span></div><div class="line">            <span class="keyword">let</span> str = <span class="string">'&lt;object type="application/x-shockwave-flash"&gt;&lt;/object&gt;'</span>;</div><div class="line">            <span class="keyword">return</span> $(str).appendTo($(<span class="string">'body'</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    getFormUploadObj () &#123;</div><div class="line">        <span class="keyword">let</span> str = <span class="string">'&lt;input name="file" type="file" calss="ui-file"/&gt;'</span>;   <span class="comment">// 表单上传</span></div><div class="line">        <span class="keyword">return</span> $(str).appendTo($(<span class="string">'body'</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 给对象getUploadObj定义iterator接口，上面演示过这段代码</span></div><div class="line"><span class="comment">// 这里可以通过工厂模式，抽象成一个专门给对象安装iterator接口的函数，这样就可以省却很多重复代码了。</span></div><div class="line"><span class="built_in">Object</span>.defineProperty(getUploadObj, <span class="built_in">Symbol</span>.iterator, &#123;</div><div class="line">    enumerable: <span class="literal">false</span>,</div><div class="line">    writable: <span class="literal">false</span>,</div><div class="line">    configurable: <span class="literal">true</span>,</div><div class="line">    value: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> o = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">var</span> idx = <span class="number">0</span>;</div><div class="line">        <span class="keyword">var</span> ks = <span class="built_in">Object</span>.keys(o);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> &#123;</div><div class="line">                    value: o[ks[idx++]],</div><div class="line">                    done: (idx &gt; ks.length)</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">iteratorUploadObj</span> (<span class="params">uploadObj</span>)</span>&#123;</div><div class="line">    <span class="comment">// 直接使用`for...of`遍历uploadObj对象</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> getUpload <span class="keyword">of</span> uploadObj)&#123;</div><div class="line">        <span class="keyword">let</span> uploadObj = getUpload();</div><div class="line">        <span class="keyword">if</span>(uploadObj) <span class="keyword">return</span> uploadObj;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> uploadObj = iteratorUploadObj(getUploadObj);</div><div class="line"><span class="built_in">console</span>.log(uploadObj);  <span class="comment">// [input, prevObject: Z.fn.init[1], context: undefined]</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/13/ES6迭代器（interator）和for...of...循环/" data-id="cj6gh2nwv0004ljdwzk8mevbj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-从ES6生成器(Generator)原理解读，到理解ES7的asyn...await..." class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/09/从ES6生成器(Generator)原理解读，到理解ES7的asyn...await.../" class="article-date">
  <time datetime="2017-08-09T01:17:50.000Z" itemprop="datePublished">2017-08-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="从ES6生成器-Generator-原理解读，到理解ES7的asyn…await…"><a href="#从ES6生成器-Generator-原理解读，到理解ES7的asyn…await…" class="headerlink" title="从ES6生成器(Generator)原理解读，到理解ES7的asyn…await…"></a>从ES6生成器(Generator)原理解读，到理解ES7的asyn…await…</h1><p>##ES6生成器原理解读<br>生成器从本质上来说，是一种特殊的<a href="https://segmentfault.com/a/1190000010637886" target="_blank" rel="external">迭代器</a>。为什么这么说呢，下面来看一段代码：</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params">arg</span>)</span>&#123;</div><div class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</div><div class="line">    <span class="keyword">yield</span> arg;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> genHandle = gen(<span class="number">3</span>);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">of</span> genHandle)&#123;</div><div class="line">  <span class="built_in">console</span>.log(i);   <span class="comment">// 依次打印：2，3</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> genHandle2 = gen(<span class="number">4</span>);</div><div class="line"><span class="built_in">console</span>.log(genHandle2.next()); <span class="comment">// &#123; value: 2, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(genHandle2.next()); <span class="comment">// &#123; value: 4, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(genHandle2.next()); <span class="comment">// &#123; value: undefined, done: true &#125;</span></div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>从上面代码可以看出生成器其实是一个<strong>变异的函数</strong>，和一般的函数<strong>没什么不同</strong>，只是多了一个 <strong>*</strong> 来区分这是一个生成器。当然生成器内部多了一个<strong>yeild语句</strong>，作用显而易见是<strong>为了停止继续执行下面的代码，相当于return的作用一样，但是不同的是它可以保存进度，可以通过代码控制继续执行。而且这里的yeild一定要在生成器的作用域范围内才会有效</strong>，这点要注意。在执行完生成器返回的对象genHandle和genHandle2可以看出，它们都是<strong>迭代器</strong>，也就是说生成器执行结果返回的是<a href="https://segmentfault.com/a/1190000010637886" target="_blank" rel="external">迭代器</a>对象，即<strong>生成器可以看成是一个迭代器的构造器，可以用来构建生成迭代器。yield在生成器构建迭代器的过成中的作用中就类似于切割代码的作用，把代码切割成一个可以迭代的集合</strong>。下面是上面的gen生成器转成ES5的代码，如下：</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen</span>(<span class="params">arg</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">gen$</span>(<span class="params">_context</span>) </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">switch</span> (_context.prev = _context.next) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">                    _context.next = <span class="number">2</span>;</div><div class="line">                    <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">                    _context.next = <span class="number">4</span>;</div><div class="line">                    <span class="keyword">return</span> arg;</div><div class="line">                <span class="keyword">case</span> <span class="number">4</span>:</div><div class="line">                <span class="keyword">case</span> <span class="string">"end"</span>:</div><div class="line">                    <span class="keyword">return</span> _context.stop();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;, _marked[<span class="number">0</span>], <span class="keyword">this</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Example：</strong>为了便于理解，下面是我实现的一个简单的regeneratorRuntime.wrap函数来生成迭代器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> context = &#123;</div><div class="line">    next:<span class="number">0</span>,</div><div class="line">    prev:<span class="literal">null</span>,</div><div class="line">    gen$:<span class="literal">null</span>,</div><div class="line">    done:<span class="literal">false</span>,</div><div class="line">    stop:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.done = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">Object</span>.defineProperty(context, <span class="built_in">Symbol</span>.iterator, &#123;</div><div class="line">    enumerable: <span class="literal">false</span>,</div><div class="line">    writable: <span class="literal">false</span>,</div><div class="line">    configurable: <span class="literal">true</span>,</div><div class="line">    value: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            next: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> nextValue = me.gen$(me);</div><div class="line">                <span class="keyword">return</span> &#123;</div><div class="line">                    value: nextValue,</div><div class="line">                    done: me.done</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> regeneratorRuntime = &#123;</div><div class="line">  wrap:<span class="function"><span class="keyword">function</span>(<span class="params">_gen</span>)</span>&#123;</div><div class="line">    context.gen$ = _gen;</div><div class="line">    <span class="keyword">return</span> context;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen</span>(<span class="params">arg</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">gen$</span>(<span class="params">_context</span>) </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</div><div class="line">          <span class="keyword">switch</span> (_context.prev = _context.next) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">              _context.next = <span class="number">2</span>;</div><div class="line">              <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">              _context.next = <span class="number">4</span>;</div><div class="line">              <span class="keyword">return</span> arg;</div><div class="line">            <span class="keyword">case</span> <span class="number">4</span>:</div><div class="line">            <span class="keyword">case</span> <span class="string">"end"</span>:</div><div class="line">              <span class="keyword">return</span> _context.stop();</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> b = gen(<span class="number">3</span>);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> c <span class="keyword">of</span> b)&#123;</div><div class="line">  <span class="built_in">console</span>.log(c);   <span class="comment">// 结果为：2，3</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##理解ES7的 asyn…await…<br><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 正常异步执行</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">demo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">    resolve(<span class="number">3</span>)</div><div class="line">  &#125;).then(<span class="function">(<span class="params">value</span>)=&gt;</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(value)</div><div class="line">  &#125;)</div><div class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</div><div class="line">&#125;</div><div class="line">demo();         <span class="comment">// 执行结果依次是：4，3</span></div><div class="line"></div><div class="line"><span class="comment">// 生成器异步转同步</span></div><div class="line"><span class="keyword">let</span> gen = <span class="literal">null</span>;</div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">genDemo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">yield</span> setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">    gen.next();</div><div class="line">  &#125;,<span class="number">100</span>)</div><div class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</div><div class="line">&#125;</div><div class="line">gen = genDemo();</div><div class="line">gen.next()  <span class="comment">// // 执行结果依次是：3，4</span></div><div class="line"></div><div class="line"><span class="comment">// async...await...异步转同步</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncDemo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">    resolve(<span class="number">3</span>)</div><div class="line">  &#125;).then(<span class="function">(<span class="params">value</span>)=&gt;</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(value)</div><div class="line">  &#125;)</div><div class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</div><div class="line">&#125;</div><div class="line">asyncDemo();    <span class="comment">// 执行结果依次是：3，4</span></div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>从上述的例子可以看出，<strong>生成器是可以解决异步如果转成同步代码的问题，而async…await…的实现原理其实也是基于生成器来实现的，不过这里要注意的是async…await…必须要配合Promise来实现，因为Promise的决议回调函数里面集成了类似于生成器gen.next()这样的代码来控制继续执行代码</strong>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/09/从ES6生成器(Generator)原理解读，到理解ES7的asyn...await.../" data-id="cj6gh2nxn000cljdwvv4djkv6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-通过回调来理解Promise" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/25/通过回调来理解Promise/" class="article-date">
  <time datetime="2017-07-25T06:07:59.000Z" itemprop="datePublished">2017-07-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#通过回调来理解Promise<br>我们都知道Promise的出现是为了规避回调地狱的，由此，我们先来深入了解一下回调的缺陷：</p>
<p>##回调</p>
<blockquote>
<p>1、缺乏信任</p>
<p>2、不确定性</p>
</blockquote>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> money = <span class="number">30</span>;</div><div class="line">order(money,<span class="function"><span class="keyword">function</span> <span class="title">getOrder</span>(<span class="params">orderId</span>)</span>&#123;  <span class="comment">// order是一个第三方的下订单的回调函数</span></div><div class="line">   orderId &amp;&amp; pay(orderId);  <span class="comment">// 获取订单编号之后调用第三方支付pay方法去付款 </span></div><div class="line">&#125;)</div><div class="line"><span class="comment">// ...同步代码</span></div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>上面的代码只是常规代码中的一部分，其中order是一个第三方下订单的方法，需要携带回调函数过去获取订单编号，这里面就存在一些信任性和不确定性的问题，如：</p>
<blockquote>
<p>1、有可能回调函数getOrder始终不会被调用，那我们就永远拿不到订单编号去支付；<br>2、有可能回调了，可是回调了不止一次，导致我们重复去支付了；<br>3、不确定回掉时间，有可能立马回调，那么接下来的同步代码就会在回调之后执行，有可能它内部调用了异步代码再回调，那么接下来的同步代码就会在回调之前执行。<br>4、也有可能下订单的第三方模块自己内部出错了，导致我们没办法捕获异常；</p>
</blockquote>
<p>上面只是回调的一部分缺陷，但其实当我们不喜欢一个东西的时候总有这么多理由，当我们喜欢一个东西的时候，没有理由也会找一堆理由的，下面就是Promise的理由。</p>
<p>##Promise</p>
<blockquote>
<p>1、可信任性</p>
<p>2、确定性</p>
</blockquote>
<p>在解决上述的回调函数的问题之前，有必要先来认识一下Promise的一些主要方法：</p>
<p>####1、Promise的起点new Promise()</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">PromiseBack</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">    resolve();</div><div class="line">    resolve();</div><div class="line">    reject();</div><div class="line">    reject();</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>);</div><div class="line">&#125;,()=&gt;&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">5</span>);</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line"><span class="comment">// 执行结果依次是：1，2，3，4</span></div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>以上代码体现了new Promise的如下特性：</p>
<blockquote>
<p>1、一旦决议（调用过一次resolve或者reject）就不再重复调用决议回调或者改变决议回调。</p>
<p>2、决议代码是同步的，可是决议的成功或失败的回调代码一定是异步的，而且Promise的异步实现比setTimeout的调用时间更早，因为回调决议存在于Event loop的microtask队列中。</p>
</blockquote>
<p>###2、多Promise同时执行：Promise.all([ .. ])</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">    resolve(<span class="number">1</span>);</div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">    resolve(<span class="number">2</span>);</div><div class="line">    <span class="comment">// reject(3);</span></div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> promise3 = <span class="built_in">Promise</span>.all([promise1,promise2]).then(<span class="function"><span class="keyword">function</span> <span class="title">resolveBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);    <span class="comment">// 打印结果是：[ 1, 2 ]</span></div><div class="line">&#125;,<span class="function"><span class="keyword">function</span> <span class="title">rejectBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);    <span class="comment">// 当promise2注释部分放开，非注释部分注释，打印结果是：3</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>Promise.all方法对于promise数组的决议是：<strong>当其中所有的promise都是成功决议的时候，就会调用成功的决议回调resolveBack，并且把promise数组的决议值以数组的形式按照顺序返回resolve中的值；如果其中哪怕有一个失败的决议都会调用失败的决议回调rejectBack，并且只返回promise宿主中失败的决议值，以数组顺序返回</strong>。</p>
<p>###3、多Promise竞赛执行：Promise.race([ .. ])<br><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    resolve(<span class="number">1</span>);</div><div class="line">  &#125;,<span class="number">100</span>);</div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="comment">//resolve(2);</span></div><div class="line">    reject(<span class="number">3</span>);</div><div class="line">  &#125;,<span class="number">50</span>);</div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> promise3 = <span class="built_in">Promise</span>.race([promise1,promise2]).then(<span class="function"><span class="keyword">function</span> <span class="title">resolveBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);    <span class="comment">// 打印结果是：2</span></div><div class="line">&#125;,<span class="function"><span class="keyword">function</span> <span class="title">rejectBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);    <span class="comment">// 当promise2注释部分放开，非注释部分注释，打印结果是：3</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>Promise.race方法和all方法不同，它对于promise数组的决议是：<strong>当promise数组中有一个成功了，那就会立即执行成功的决议回调，当有一个失败了，就会立即执行失败的决议回调，所以，它也叫*</strong>竞赛决议<em>，它的一个常用的应用场景就是<strong>异步请求超时处理</strong>，代码如下：<br>**</em>Example:<em>*</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// request(..)是一个支持Promise的Ajax工具</span></div><div class="line"><span class="keyword">let</span> promise1 = request( <span class="string">"http://some.url.1/"</span>);</div><div class="line"><span class="keyword">let</span> promise2 = <span class="function"><span class="keyword">function</span>(<span class="params">second=<span class="number">1000</span></span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">      reject(<span class="string">'请求超时'</span>);</div><div class="line">    &#125;,second)</div><div class="line">  &#125;)</div><div class="line">&#125;;</div><div class="line"><span class="keyword">let</span> promise3 = <span class="built_in">Promise</span>.race([promise1,promise2(<span class="number">3000</span>)])</div><div class="line">.then(<span class="function"><span class="keyword">function</span> <span class="title">resolveBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);</div><div class="line">&#125;,<span class="function"><span class="keyword">function</span> <span class="title">rejectBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);    <span class="comment">// 当请求超时3秒钟就决议失败，打印错误信息，如果这里信息是统一处理，那最好超时的值构造成和异步请求返回错误结果的值一致</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>###4、Promise错误处理catch…<br><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(a);</div><div class="line">&#125;).catch(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(err);     <span class="comment">// 打印结果：33 [ReferenceError: a is not defined]</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>catch和then一样都是Promise的<strong>实例方法</strong>，而且也都调用完成之后也都会<strong>返回一个新的Promise实例</strong>，这样就可以继续then或catch了，这也就是<strong>Promise的“链式流”</strong>。其实catch本身实现和then是类似的，可以完全看成是then仅有失败决议回调，即：<strong>then(null,(err)=&gt;{})。也就是说then的失败决议当Promise决议代码出错了，哪怕没有调用reject方法，也是会被捕获到错误的</strong>。</p>
<p>###总结<br>浏览过上述方法之后，我们现在来解决一开始我们遇到的那个回调函数的问题，解决问题代码如下：</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> money = <span class="number">30</span>;</div><div class="line"><span class="keyword">let</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">    order(money,<span class="function"><span class="keyword">function</span> <span class="title">getOrder</span>(<span class="params">orderId</span>)</span>&#123; </div><div class="line">        orderId ? resolve(orderId) : reject(orderId);</div><div class="line">    &#125;); </div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> promise2 = <span class="function"><span class="keyword">function</span>(<span class="params">second=<span class="number">1000</span></span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">      reject(<span class="string">'请求超时'</span>);</div><div class="line">    &#125;,second)</div><div class="line">  &#125;)</div><div class="line">&#125;;</div><div class="line"><span class="keyword">let</span> promise3 = <span class="built_in">Promise</span>.race([promise1,promise2(<span class="number">3000</span>)])</div><div class="line">.then(<span class="function"><span class="keyword">function</span> <span class="title">resolveBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);</div><div class="line">&#125;,<span class="function"><span class="keyword">function</span> <span class="title">rejectBack</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);    <span class="comment">// 当请求超时，或者order内部代码错误等都会调用失败的决议</span></div><div class="line">&#125;)</div><div class="line"><span class="comment">// ...同步代码</span></div></pre></td></tr></table></figure>
<p><strong>代码解读：</strong>上面这个Promise例子展示了对回调问题的规避，具体解决思路是：</p>
<blockquote>
<p>1、通过使用Promise.race竞赛决议方法解决如果第三方的order方法不调用getOrder的情况，可以定位到具体的错误代码和错误原因；<br>2、根据Promise的决议特性：一旦决议不可状态不可更改，不可重复。解决了回调了不止一次的问题；<br>3、根据Promise的决议回调是异步的特性，决议的回调一定是异步的特性，解决了回调时间的不确定性。<br>4、根据rejectBack类似catch的特性，失败的决议回调是可以捕获到决议代码异常的报错的，那这样，如果第三方内部出现了问题，是可以捕获到的。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/25/通过回调来理解Promise/" data-id="cj6gh2ny7000jljdwx1z5ktym" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-从ES6的Proxy代理看ES5的代理如何实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/21/从ES6的Proxy代理看ES5的代理如何实现/" class="article-date">
  <time datetime="2017-07-20T23:26:40.000Z" itemprop="datePublished">2017-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="从ES6的Proxy代理看ES5的代理如何实现"><a href="#从ES6的Proxy代理看ES5的代理如何实现" class="headerlink" title="从ES6的Proxy代理看ES5的代理如何实现"></a>从ES6的Proxy代理看ES5的代理如何实现</h1><p>###ES6的Proxy代理</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = &#123;<span class="attr">name</span>:<span class="string">''</span>&#125;;</div><div class="line"><span class="keyword">var</span> personCopy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(person,&#123;</div><div class="line">  get(target,key,receiver)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'get方法被拦截。。。'</span>);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target,key,receiver);</div><div class="line">  &#125;,</div><div class="line">  set(target,key,value,receiver)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'set方法被拦截。。。'</span>)</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target,key,value,receiver);</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line">person.name = <span class="string">'arvin'</span>;  <span class="comment">// 未有拦截日志打出</span></div><div class="line">personCopy.name = <span class="string">'arvin'</span>;  <span class="comment">// set方法被拦截。。。</span></div><div class="line"><span class="built_in">console</span>.log(person.name);   <span class="comment">// 未有拦截日志打出</span></div><div class="line"><span class="built_in">console</span>.log(personCopy.name);   <span class="comment">// get方法被拦截。。。</span></div></pre></td></tr></table></figure>
<p><strong><em>代码解读：</em></strong>从上述的例子可以看出，<strong>被代理对象person</strong>的get和set不会经过代理拦截器get，set，而只有<strong>代理对象personCopy</strong>在get和set方法调用的时候才会经过拦截器，由此可见ES6的代理Proxy并不是一个类似<strong>JAVA的AOP</strong>，而其实只是将person的<strong>引用</strong>赋值给了personCopy，让代理对象personCopy和被代理对象person指向了<strong>同一个内存空间</strong>，下面是我实现的一个用ES5写的Proxy拦截，供大家参考理解Proxy实现原理提供思路：</p>
<p><strong><em>Example：</em></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**浅拷贝工具方法**/</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">myObj</span>)</span>&#123;  </div><div class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span>(myObj) != <span class="string">'object'</span> || myObj == <span class="literal">null</span>) <span class="keyword">return</span> myObj;  </div><div class="line">    <span class="keyword">var</span> newObj = <span class="keyword">new</span> <span class="built_in">Object</span>();  </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> myObj)&#123;  </div><div class="line">      newObj[i] = clone(myObj[i]); </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> newObj;  </div><div class="line">&#125;</div><div class="line"><span class="comment">/*代理实现类*/</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProxyCopy</span>(<span class="params">target,handle</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> targetCopy = clone(target);</div><div class="line">  <span class="built_in">Object</span>.keys(targetCopy).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</div><div class="line">    <span class="built_in">Object</span>.defineProperty(targetCopy, key, &#123;</div><div class="line">      get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> handle.get &amp;&amp; handle.get(target,key);</div><div class="line">      &#125;,</div><div class="line">      set: <span class="function"><span class="keyword">function</span>(<span class="params">newVal</span>) </span>&#123;</div><div class="line">        handle.set &amp;&amp; handle.set();</div><div class="line">        target[key] = newVal;</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">return</span> targetCopy;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> person = &#123;<span class="attr">name</span>:<span class="string">''</span>&#125;;</div><div class="line"><span class="keyword">var</span> personCopy = <span class="keyword">new</span> ProxyCopy(person,&#123;</div><div class="line">  get(target,key)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'get方法被拦截。。。'</span>);</div><div class="line">    <span class="keyword">return</span> target[key];</div><div class="line">  &#125;,</div><div class="line">  set(target,key,value)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'set方法被拦截。。。'</span>)</div><div class="line">    <span class="comment">// return true;</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line">person.name = <span class="string">'arvin'</span>;  <span class="comment">// 未有拦截日志打出</span></div><div class="line">personCopy.name = <span class="string">'arvin'</span>;  <span class="comment">// set方法被拦截。。。</span></div><div class="line"><span class="built_in">console</span>.log(person.name);   <span class="comment">// 未有拦截日志打出</span></div><div class="line"><span class="built_in">console</span>.log(personCopy.name);   <span class="comment">// get方法被拦截。。。</span></div></pre></td></tr></table></figure>
<p>###ES5对Proxy代理的实现</p>
<p>要说到ES5的代理实现，其中比较有名的就算是vue的双向绑定中到了get和set的代理拦截实现了，下面是一个仿照该技术的一个实现：</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 拦截器</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.data = data;</div><div class="line">    <span class="keyword">this</span>.walk(data);</div><div class="line">&#125;</div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$Observer</span>)</span>&#123;</div><div class="line">    $Observer.prototype = &#123;</div><div class="line">        walk: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">            <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</div><div class="line">                me.convert(key, data[key]);</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        convert: <span class="function"><span class="keyword">function</span>(<span class="params">key, val</span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.defineReactive(<span class="keyword">this</span>.data, key, val);</div><div class="line">        &#125;,</div><div class="line">        defineReactive: <span class="function"><span class="keyword">function</span>(<span class="params">data, key, val</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> childObj = observe(val);</div><div class="line">            <span class="built_in">Object</span>.defineProperty(data, key, &#123;</div><div class="line">                enumerable: <span class="literal">true</span>, <span class="comment">// 可枚举</span></div><div class="line">                configurable: <span class="literal">false</span>, <span class="comment">// 不能再define</span></div><div class="line">                get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">return</span> val;</div><div class="line">                &#125;,</div><div class="line">                set: <span class="function"><span class="keyword">function</span>(<span class="params">newVal</span>) </span>&#123;</div><div class="line">                    <span class="keyword">if</span> (newVal === val) &#123;</div><div class="line">                        <span class="keyword">return</span>;</div><div class="line">                    &#125;</div><div class="line">                    val = newVal;</div><div class="line">                    <span class="built_in">console</span>.log(<span class="string">"新的值是object的话，进行监听"</span>);</div><div class="line">                    <span class="built_in">console</span>.log(<span class="string">"通知订阅者"</span>);</div><div class="line">                    dep.notify();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">&#125;;</div><div class="line">&#125;)(Observer);</div><div class="line"><span class="comment">// 拦截器的出口</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">observe</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!value || <span class="keyword">typeof</span> value !== <span class="string">'object'</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Observer(value);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/21/从ES6的Proxy代理看ES5的代理如何实现/" data-id="cj6gh2nxb0009ljdwmg2dz9wj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JavaScript中线程运行机制详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/20/JavaScript中线程运行机制详解/" class="article-date">
  <time datetime="2017-07-20T10:57:41.000Z" itemprop="datePublished">2017-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JavaScript中线程运行机制详解"><a href="#JavaScript中线程运行机制详解" class="headerlink" title="JavaScript中线程运行机制详解"></a>JavaScript中线程运行机制详解</h1><p>对于JavaScript我们都知道，他是个<strong>单线程语言</strong>，但是准确来说它是拥有一个<strong>执行程序主线程</strong>，和<strong>消息队列辅线程（Event Loop）</strong>，以及<strong>各个真正处理异步操作的工作线程</strong>。<br>当主线程执行JS程序的时候，如果遇到了<strong>异步的操作</strong>（如：click事件，setTimeOut,I/0操作,异步请求,Promise等）,主线程将各个异步任务交给<strong>工作线程</strong>，主线程继续执行，<strong>工作线程会判断是否到了要执行该异步操作</strong>的条件了，如果工作线程判断已经到了要执行工作线程的条件之后，就会把回调函数放入辅线程<strong>Event Loop</strong>的<strong>macrotask任务队列或者microtask任务队列的</strong>队尾。当上述主线程执行完后续同步调用的代码之后，辅线程会一直循环上面两个队列，首先执行的是microtask任务队列，而且该任务队列是该次循环就会执行完并清空的，macrotask会等到下次event loop循环的时候执行。</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span>  <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line"><span class="number">2.</span>  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timerCallback</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="number">3.</span>    <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line"><span class="number">4.</span>  &#125;,<span class="number">0</span>)</div><div class="line"><span class="number">5.</span>  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line"><span class="number">6.</span>     <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line"><span class="number">7.</span>     <span class="keyword">if</span>(<span class="literal">true</span>)</div><div class="line"><span class="number">8.</span>         resolve();</div><div class="line"><span class="number">9.</span>  &#125;).then(<span class="function"><span class="keyword">function</span> <span class="title">resolveCallback</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="number">10.</span>     <span class="built_in">console</span>.log(<span class="number">4</span>);</div><div class="line"><span class="number">11.</span> &#125;);</div><div class="line"><span class="number">12.</span> <span class="built_in">console</span>.log(<span class="number">5</span>);</div><div class="line"><span class="comment">// 上面程序执行的顺序是：1，3，5，4，2</span></div></pre></td></tr></table></figure>
<p><strong><em>代码详解：</em></strong>当主线程执行上述代码的时候，从<strong>上往下执行</strong>：<br>1、先将console.log(1)这句代码做一个<strong>入栈执行</strong>的操作，打印出1，该句代码没有<strong>后续的方法调用</strong>了，就<strong>出栈销毁</strong>；</p>
<p>2、执行setTimeout，将改句代码入栈执行，判断到该方法属于<strong>WebAPIs</strong>（JS工作线程提供API的统称，其中包含了webcore工作模块提供了DOM Binding、network、timer等），timerCallback方法出栈，交给工作线程webcore下的timer模块，这里timer模块会判断是否到了执行条件了，由于是延时是0，所以timer模块判断可以执行了，并将回调函数timerCallback放到辅助线程<strong>Event Loop的macrotask队尾</strong>，等待<strong>下一次Event Loop循环</strong>去执行。</p>
<p>3、继续执行Promise这句代码（<strong>包括then语句</strong>），将其入栈执行，判断该Promise属于<strong>Promise模块</strong>（非WebAPIs）,将其then的回调函数交给Promise模块，有后续调用；将execute方法入栈执行，有后续调用；将console.log(3)入栈执行，打印出3，console.log(3)执行完毕，出栈销毁；有后续调用if(true)入栈执行，判断为true，出栈销毁，继续将resolve()入栈执行，判断<strong>resolve()是WebAPIs的成功的回调</strong>，执行的时候通知到上面的Promise模块，<strong>Promise模块将成功的回调放到Event Loop的microtask队尾</strong>，resolve()出栈销毁，无后续调用，Promise出栈销毁。</p>
<p>4、继续执行，将console.log(5)入栈执行,打印出5，无后续调用，出栈销毁。</p>
<p>5、<strong>Event Loop开始循环microtask队列</strong>，将resolveCallback()入栈执行，有后续调用；将console.log(4)入栈执行，打印出4，出栈销毁；无后续调用，resolveCallback()出栈销毁，清空队列。</p>
<p>6、<strong>Event Loop开始循环macrotask队列</strong>，将timerCallback()入栈执行，有后续调用；将console.log(2)入栈执行，打印出2，出栈销毁，无后续调用；将timerCallback()出栈销毁，清空队列。</p>
<p>###备注：<br>macrotask任务队列的来源有：</p>
<ul>
<li>setTimeout</li>
<li>setInterval</li>
<li>setImmediate</li>
<li>I/O</li>
<li>UI rendering</li>
</ul>
<p>microtask任务队列的来源有：</p>
<ul>
<li>process.nextTick</li>
<li>promises</li>
<li>Object.observe</li>
<li>MutationObserver</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/20/JavaScript中线程运行机制详解/" data-id="cj6gh2nwt0003ljdw8mpethv7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ES5的原型链和ES6的类实现详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/19/ES5的原型链和ES6的类实现详解/" class="article-date">
  <time datetime="2017-07-19T10:34:51.000Z" itemprop="datePublished">2017-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ES5的原型链和ES6的类实现详解"><a href="#ES5的原型链和ES6的类实现详解" class="headerlink" title="ES5的原型链和ES6的类实现详解"></a>ES5的原型链和ES6的类实现详解</h1><p>JavaScript最初设计时受到了<strong>面相对象编程</strong>的影响，从而引入了<strong>new关键字</strong>，来<strong>实例化对象</strong>。而在ES5中new后面跟着的是<strong>构造函数</strong>（也是函数），而到了ES6则改成了<strong>clas</strong>了，而一开始new创建对象都是<strong>独立的对象</strong>，并不能像java那样拥有<strong>继承</strong>的概念，去<strong>共享变量和方法</strong>，为了解决这个问题，JavaScript就又给构造函数设计了一个<strong>prototype</strong>属性，这样所有<strong>私有的方法和变量</strong>就放到<strong>构造函数</strong>里面定义，而所有的<strong>公共的变量和方法</strong>就放到<strong>prototype对象</strong>里面，这样当构造函数创建一个实例化的对象的时候，就即拥有自己的私有变量和方法，也有公有的变量和方法了，实例化出来的对象的私有方法和变量修改都不会互相有影响，只有在修改公有的变量和方法的时候是对所有实例生效的。</p>
<p>###ES5原型链<br><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;</div><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$Person</span>)</span>&#123;</div><div class="line">    $Person.prototype = &#123;</div><div class="line">        welcome: <span class="string">"hello"</span>,</div><div class="line">        introduce: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.welcome + <span class="string">",I am "</span> + <span class="keyword">this</span>.name;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)(Person)</div><div class="line"></div><div class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"arvin"</span>);</div><div class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">"peter"</span>);</div><div class="line"><span class="built_in">console</span>.log(person1.introduce());   <span class="comment">// hello,I am arvin</span></div><div class="line"><span class="built_in">console</span>.log(person2.introduce());   <span class="comment">// hello,I am peter</span></div><div class="line"></div><div class="line">person1.__proto__.welcome = <span class="string">"hi"</span>;</div><div class="line"><span class="built_in">console</span>.log(person1.introduce());   <span class="comment">// hi,I am arvin</span></div><div class="line"><span class="built_in">console</span>.log(person2.introduce());   <span class="comment">// hi,I am peter</span></div></pre></td></tr></table></figure>
<p><strong><em>代码解读：</em></strong>以上是本人推荐在使用ES5时，写原型链的方法，目的是为了代码简洁，方便复用，仅供参考。代码中在原型链上定义了一个welcome<strong>公共变量</strong>，这里要注意的是如果有同样名称的<strong>私有变量</strong>welcome时，原型方法introduce里面的this.welcome会<strong>首先查找私有变量welcome并使用</strong>，这个其实就和面相对象的<strong>覆写</strong>类似了。另外可以看出，ES5的构造函数（一般首字母大写以区分普通函数）在new的时候确实是<strong>创建了不同的区块</strong>来存放其<strong>私有变量</strong>name的值的，而对于原型链的变量welcome和方法introduce也确实是各个Person实例<strong>共用了同一块内存区域</strong>的，只要其中<strong>一个</strong>修改了原型链上的变量<strong>其他所有的对象实例</strong>再调用的时候从公共内存取出来的也就是被修改过只有的值了，这里要注意的是，构造函数new出来的实例对象，创建出来的指向原型链prototype的是其<strong>proto</strong>属性，也就是说<strong>person1.<strong>proto</strong> === Person.prototype === person2.<strong>proto</strong></strong>，这也从实际上证明了<strong>原型链对象在内存中只存了一份，是共用的</strong>。</p>
<p>###ES6类<br><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(name) &#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    welcome = <span class="string">'hello'</span>;  <span class="comment">// S7才支持实例属性</span></div><div class="line">    introduce()&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.welcome + <span class="string">",I am "</span> + <span class="keyword">this</span>.name;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"arvin"</span>);</div><div class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">"peter"</span>);</div><div class="line"><span class="built_in">console</span>.log(person1.introduce());   <span class="comment">// hello,I am arvin</span></div><div class="line"><span class="built_in">console</span>.log(person2.introduce());   <span class="comment">// hello,I am peter</span></div><div class="line"></div><div class="line">person1.__proto__.welcome = <span class="string">"hi"</span>;</div><div class="line"><span class="built_in">console</span>.log(person1.introduce());   <span class="comment">// hi,I am arvin</span></div><div class="line"><span class="built_in">console</span>.log(person2.introduce());   <span class="comment">// hi,I am peter</span></div></pre></td></tr></table></figure>
<p><strong><em>代码解读：</em></strong>上面暂时只是概念性的写法，事实上，ES6的类只是一个ES5原型链的语法糖而已，主要是从写法上更接近于面相对象的类而已，另外一个作用就是区分ES5的构造函数和函数之间的区分。</p>
<p>###小结：对于ES5和ES6的类似面相对象和非面向对象的原因，以java为例提出以下几点个人见解：</p>
<blockquote>
<p>1、java在继承（extend）的时候，子类是会复制一遍所有父类的方法和属性（除已覆写的除外）到一个独立的内存空间中的，即所有子类之间不存在任何的关系；而这点其实就和ES5的原型继承prototype和ES6的extend有很大的不同了。</p>
<p>2、java在new创建一个实例的时候同样是会开辟一个独立的属于该实例的内存空间，同一个类的实例之间互不影响；而ES5和ES6的创建实例的时候实例仍然是和类是存在关联的，而且是可以直接影响到类以及其他子类的公共状态和方法的。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/19/ES5的原型链和ES6的类实现详解/" data-id="cj6gh2nx30006ljdwuwiqv5lt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-对ES5中apply、call和bind三个方法的解读" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/19/对ES5中apply、call和bind三个方法的解读/" class="article-date">
  <time datetime="2017-07-18T23:32:54.000Z" itemprop="datePublished">2017-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="对ES5中apply、call和bind三个方法的解读"><a href="#对ES5中apply、call和bind三个方法的解读" class="headerlink" title="对ES5中apply、call和bind三个方法的解读"></a>对ES5中apply、call和bind三个方法的解读</h1><p>JavaScript中，apply、call 和 bind 都是为了改变某个函数<strong>运行时的上下文</strong>而存在的，其实就是为了改变所调用的函数体内部 <strong>this 的指向</strong>。</p>
<p>###Function.prototype.apply()方法</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> nodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">"div"</span>);</div><div class="line"><span class="built_in">Array</span>.prototype.slice.apply(nodeList).forEach(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(node);    <span class="comment">// 输出每一个div节点对象</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong><em>代码解读：</em></strong><br>上面是一段JS中常用的代码，这段代码表示的意义是，当我们获取到一个<strong>类数组</strong>的对象的时候如何让它可以调用所有<strong>数组</strong>所拥有的方法。我们都知道，所有的获取dom元素的方法，返回的不是dom节点对象，就是包含节点对象的<strong>类数组</strong>，而类数组虽然从输出来看和数组是没什么区别的，但是在原型链上是有很大的差异的。像NodeList这个类数组就是不包含基本上所有数组的常用方法的，所以这个时候就需要 <strong>借</strong> 数组的<strong>slice</strong>方法来将NodeList这个歌类数组转成真正的数组对象，这样就可以直接调用push方法了。</p>
<h3 id="Function-prototype-call-方法"><a href="#Function-prototype-call-方法" class="headerlink" title="Function.prototype.call()方法"></a>Function.prototype.call()方法</h3><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> nodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">"div"</span>);</div><div class="line"><span class="built_in">Array</span>.prototype.slice.call(nodeList).forEach(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(node);    <span class="comment">// 输出每一个div节点对象</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong><em>代码解读：</em></strong>上面这段代码和apply方法中的例子是一模一样的，所以，其实他们两个方法的作用都是一致的，用法呢就是类似的，而为什么说是类似的呢，看下面这个例子：<br><strong>Example：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> max1 = <span class="built_in">Math</span>.max.call(<span class="literal">null</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>); </div><div class="line"><span class="keyword">var</span> max2 = <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</div><div class="line"><span class="built_in">console</span>.log(max1);      <span class="comment">// 结果是3</span></div><div class="line"><span class="built_in">console</span>.log(max2)       <span class="comment">// 结果是3</span></div></pre></td></tr></table></figure>
<p><strong><em>代码解读：</em></strong>从上面这个例子中可以看出，call和apply的用法不同之处在于，如果所调用的方法方法需要传入参数，那么call需要从第二个入参开始传入需要的<strong>值</strong>，而apply是在第二入参用<strong>数组</strong>来传递参数，这里要注意的是哪怕是参数只需要传入一个，也全都按照这种语法规则，不然如上面的<strong>Math.max</strong>就会报<strong>TypeError</strong>，所以建议如下：<strong>当所调用的方法是0个参数的，那随便哪个都可以，如果是1~2个参数的建议使用call方法，如果是3个及以上的用apply方法</strong>。</p>
<h3 id="Function-prototype-bind-方法"><a href="#Function-prototype-bind-方法" class="headerlink" title="Function.prototype.bind()方法"></a>Function.prototype.bind()方法</h3><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> nodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">"div"</span>);</div><div class="line"><span class="keyword">var</span> nodeArray = <span class="built_in">Array</span>.prototype.slice.bind(nodeList);</div><div class="line">nodeArray().forEach(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(node);    <span class="comment">// 输出每一个div节点对象</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong><em>代码解读：</em></strong>从上面的例子看一看出bind方法只是<strong>替换了所调用方法的this指向</strong>，并不会<strong>主动去执行</strong>这个方法，而apply和call方法是<strong>即改变了this指向，又立即执行的</strong>，所以bind一般用于不需要立即执行，只要求更改this指向的场景，如：click事件的回调函数一般就会用bind去改变回调函数的this指向，而在click事件触发的时候执行。最后说明一下，bind的参数和call的参数传递是一致的，例子如下：</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> maxBind = <span class="built_in">Math</span>.max.bind(<span class="literal">null</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>); </div><div class="line"><span class="keyword">var</span> max = maxBind();</div><div class="line"><span class="built_in">console</span>.log(max);      <span class="comment">// 结果是3</span></div></pre></td></tr></table></figure>
<p><strong>结束语：</strong>上面就是javaScript对于如何改变运行时上下文的三个方法了，下面是我自己实现的一个类似运行时改变上下文的方法，不适合在实际场景中使用，仅供大家参考：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Person = &#123;</div><div class="line">  context:<span class="literal">null</span>,</div><div class="line">  name:<span class="string">'小明'</span>,</div><div class="line">  say:<span class="function"><span class="keyword">function</span>(<span class="params">greeting</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> me = <span class="keyword">this</span>.context || <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">return</span> greeting + me.name</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">Person.say.__proto__.callCopy = <span class="function"><span class="keyword">function</span>(<span class="params">_context,greeting</span>)</span>&#123;</div><div class="line">  Person.context = _context;</div><div class="line">  <span class="keyword">return</span> Person.say(greeting);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> world1 =Person.say(<span class="string">'你好 '</span>);</div><div class="line"><span class="keyword">var</span> world2 = Person.say.callCopy(&#123;<span class="attr">name</span>:<span class="string">'xiaoMing'</span>&#125;,<span class="string">'hello '</span>);</div><div class="line"><span class="built_in">console</span>.log(world1);    <span class="comment">// 你好 小明  </span></div><div class="line"><span class="built_in">console</span>.log(world2);    <span class="comment">// hello xiaoMing</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/19/对ES5中apply、call和bind三个方法的解读/" data-id="cj6gh2nxs000dljdwc861h7de" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-常用正则表达式及其思路详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/16/常用正则表达式及其思路详解/" class="article-date">
  <time datetime="2017-07-16T00:20:27.000Z" itemprop="datePublished">2017-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="常用正则表达式及其思路详解"><a href="#常用正则表达式及其思路详解" class="headerlink" title="常用正则表达式及其思路详解"></a>常用正则表达式及其思路详解</h1><p><strong>注意：</strong>正则表达式的匹配<strong>超大文本</strong>的效率比较低，为了匹配效率加快，最好是是先精确到小模块，再使用正则匹配，这样搜索效率会快一点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> vaildReg = &#123;</div><div class="line">  <span class="comment">//判断是否为QQ号码</span></div><div class="line">  isQQ:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.校验首字母是不是数字,并且大于0。^[1-9]</span></div><div class="line">    <span class="comment">//2.校验QQ总长度最大为11位，最小为5位</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^[1-9][0-9]&#123;4,10&#125;$/g</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否为手机号码</span></div><div class="line">  isMobile:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.手机号的第一个是1开头</span></div><div class="line">    <span class="comment">//2.手机号的第二位虽然一般都是3，4，5，7，8，但是为了防止以后再增长所以不校验第二位</span></div><div class="line">    <span class="comment">//3.手机号第三位以后的9位都是[0-9]之间的数字</span></div><div class="line">    <span class="comment">//4.总长度是11位</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^1[0-9]&#123;10&#125;$/g</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否为合法的email邮箱</span></div><div class="line">  isMail:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.中间有@符号</span></div><div class="line">    <span class="comment">//2.@符号前面有至少1位数字或字母</span></div><div class="line">    <span class="comment">//3.@符号后面以什么什么.加上字母结尾</span></div><div class="line">    <span class="comment">//4.@和.com之间有至少1位数字或字母</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^[0-9a-zA-Z.-]&#123;1,&#125;@[0-9a-zA-Z.-]&#123;1,&#125;.[a-zA-Z]+$/g</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否为数字</span></div><div class="line">  isNumber:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.开头一直到最后都是数字^\d+</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^\d+$/g</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否全都为中文</span></div><div class="line">  isAllChinese:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.正则判断中文根据unicode编码来判断，中文在unicode编码中是\u4e00到\u9fa5，共有20901个汉字</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^[\u4e00-\u9fa5]+$/gm</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否包含中文</span></div><div class="line">  isContainChinese:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.正则判断中文根据unicode编码来判断，中文在unicode编码中是\u4e00到\u9fa5，共有20901个汉字</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/[\u4e00-\u9fa5]/gm</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否为邮政编码</span></div><div class="line">  isPostcode:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.首字母不为0，再有5个任意数字</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^[^0][0-9]&#123;5&#125;$/g</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否为合法的身份证号码，校验15位和18位身份证</span></div><div class="line">  isIDcard:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.15位的身份证号码是有18**|19**年出身的人</span></div><div class="line">    <span class="comment">//2.18位的身份证末尾多了一个随机校验码</span></div><div class="line">    <span class="comment">//3.身份证前6位是地址码，后8位是出身日期，再后3位是顺序码，最后一位是校验码。</span></div><div class="line">    <span class="comment">//4.地址码表示编码对象常住户口所在县(市、旗、区)的行政区划代码。</span></div><div class="line">    <span class="comment">//5.出生日期码表示编码对象出生的年、月、日，其中年份用四位数字表示，年、月、日之间不用分隔符。</span></div><div class="line">    <span class="comment">//6.顺序码表示同一地址码所标识的区域范围内，对同年、月、日出生的人员编定的顺序号。顺序码的奇数分给男性，偶数分给女性。</span></div><div class="line">    <span class="comment">//7.校验码是根据前面十七位数字码，按照ISO 7064:1983.MOD 11-2校验码计算出来的检验码。</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^[1-9]\d&#123;5&#125;(18|19|20)?\d&#123;2&#125;(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d&#123;3&#125;(\d|X)?$/g</span>;</div><div class="line">    <span class="comment">//前两位地址码规律</span></div><div class="line">    <span class="keyword">var</span> city=&#123;<span class="number">11</span>:<span class="string">"北京"</span>,<span class="number">12</span>:<span class="string">"天津"</span>,<span class="number">13</span>:<span class="string">"河北"</span>,<span class="number">14</span>:<span class="string">"山西"</span>,<span class="number">15</span>:<span class="string">"内蒙古"</span>,<span class="number">21</span>:<span class="string">"辽宁"</span>,<span class="number">22</span>:<span class="string">"吉林"</span>,<span class="number">23</span>:<span class="string">"黑龙江 "</span>,<span class="number">31</span>:<span class="string">"上海"</span>,<span class="number">32</span>:<span class="string">"江苏"</span>,<span class="number">33</span>:<span class="string">"浙江"</span>,<span class="number">34</span>:<span class="string">"安徽"</span>,<span class="number">35</span>:<span class="string">"福建"</span>,<span class="number">36</span>:<span class="string">"江西"</span>,<span class="number">37</span>:<span class="string">"山东"</span>,<span class="number">41</span>:<span class="string">"河南"</span>,<span class="number">42</span>:<span class="string">"湖北 "</span>,<span class="number">43</span>:<span class="string">"湖南"</span>,<span class="number">44</span>:<span class="string">"广东"</span>,<span class="number">45</span>:<span class="string">"广西"</span>,<span class="number">46</span>:<span class="string">"海南"</span>,<span class="number">50</span>:<span class="string">"重庆"</span>,<span class="number">51</span>:<span class="string">"四川"</span>,<span class="number">52</span>:<span class="string">"贵州"</span>,<span class="number">53</span>:<span class="string">"云南"</span>,<span class="number">54</span>:<span class="string">"西藏 "</span>,<span class="number">61</span>:<span class="string">"陕西"</span>,<span class="number">62</span>:<span class="string">"甘肃"</span>,<span class="number">63</span>:<span class="string">"青海"</span>,<span class="number">64</span>:<span class="string">"宁夏"</span>,<span class="number">65</span>:<span class="string">"新疆"</span>,<span class="number">71</span>:<span class="string">"台湾"</span>,<span class="number">81</span>:<span class="string">"香港"</span>,<span class="number">82</span>:<span class="string">"澳门"</span>,<span class="number">91</span>:<span class="string">"国外 "</span>&#125;;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">if</span>(!city[str.substr(<span class="number">0</span>,<span class="number">2</span>)])&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="comment">//18位身份证需要验证最后一位校验位</span></div><div class="line">        <span class="keyword">if</span>(str.length == <span class="number">18</span>)&#123;</div><div class="line">            <span class="keyword">var</span> arrInt = [<span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>];</div><div class="line">            <span class="keyword">var</span> arrCh = [<span class="string">'1'</span>, <span class="string">'0'</span>, <span class="string">'X'</span>, <span class="string">'9'</span>, <span class="string">'8'</span>, <span class="string">'7'</span>, <span class="string">'6'</span>, <span class="string">'5'</span>, <span class="string">'4'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>];</div><div class="line">            <span class="keyword">var</span> sum = <span class="number">0</span>, i, residue;</div><div class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">17</span>; i++) &#123;</div><div class="line">              sum += str.substr(i, <span class="number">1</span>) * arrInt[i];</div><div class="line">            &#125;</div><div class="line">            residue = arrCh[sum % <span class="number">11</span>];</div><div class="line">            <span class="keyword">if</span> (residue !== str.substr(<span class="number">17</span>, <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否为合法http地址</span></div><div class="line">  isURL:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.合法URL地址，协议一定不能少,是不是https的就不所谓了</span></div><div class="line">    <span class="comment">//2.双斜杠之后，可能会存在域名地址，也可能是IP地址(可能就会带端口好了)</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^https?:\/\/[a-zA-Z0-9._-]+(:\d+)?(\/((\.)?(\?)?=?&amp;?[a-zA-Z0-9_-](\?)?)*)*$/i</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//判断是否为合法的IP4地址</span></div><div class="line">  isIP4:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">// 1、1.1.1.1  四段  [0 , 255]</span></div><div class="line">    <span class="comment">// 2.第一段不能为0</span></div><div class="line">    <span class="comment">// 3.每个段不能以0开头</span></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^([1-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\.([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]))&#123;3&#125;$/gi</span>;</div><div class="line">    <span class="keyword">if</span>(reg.test(str))&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">//去掉前后所有的空格，换行等</span></div><div class="line">  trim:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">    <span class="comment">//1.开头空格，匹配多次^(\s|\n|\r)+</span></div><div class="line">    <span class="comment">//2.末尾空格，匹配多次(\s|\n|\r)+$</span></div><div class="line">    str = str + <span class="string">''</span>;</div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/^\s|\s+$/gim</span>;</div><div class="line">    <span class="keyword">return</span> str.replace(reg,<span class="string">''</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'QQ'</span>,vaildReg.isQQ(<span class="string">'12345678901'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'手机'</span>,vaildReg.isMobile(<span class="string">'13700000000'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'邮箱'</span>,vaildReg.isMail(<span class="string">'1333-.@3.a'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'数字'</span>,vaildReg.isNumber(<span class="string">'0333'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'全为中文'</span>,vaildReg.isAllChinese(<span class="string">'你三好'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'包含中文'</span>,vaildReg.isContainChinese(<span class="string">'33AAA你AA'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'邮政编码'</span>,vaildReg.isPostcode(<span class="string">'123456'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'身份证号码'</span>,vaildReg.isIDcard(<span class="string">'362321199310207836'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'URL地址'</span>,vaildReg.isURL(<span class="string">'http://33:33/JM2X/1'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'IP地址'</span>,vaildReg.isIP4(<span class="string">'925.255.255.255'</span>)?<span class="string">'校验通过'</span>:<span class="string">'校验失败'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'去除空格:'</span>,vaildReg.trim(<span class="string">' \n\r\tAAA   03\r33  \r'</span>));</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/16/常用正则表达式及其思路详解/" data-id="cj6gh2nxz000gljdwt8aznrri" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/17/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/08/14/解读vue双向绑定的内部实现原理/">(no title)</a>
          </li>
        
          <li>
            <a href="/2017/08/13/ES6迭代器（interator）和for...of...循环/">(no title)</a>
          </li>
        
          <li>
            <a href="/2017/08/09/从ES6生成器(Generator)原理解读，到理解ES7的asyn...await.../">(no title)</a>
          </li>
        
          <li>
            <a href="/2017/07/25/通过回调来理解Promise/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>